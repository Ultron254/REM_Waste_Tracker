# .github/workflows/ci.yml

name: QA CI Pipeline

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  backend-tests:
    name: Run Backend API Tests
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: 18

    - name: Install Backend Dependencies
      working-directory: backend
      run: npm install

    - name: Run Jest API Tests
      working-directory: backend
      run: npm test -- --coverage

    - name: Upload Coverage Report
      uses: actions/upload-artifact@v3
      with:
        name: backend-coverage
        path: backend/coverage

  # Optional: UI Tests (Selenium in Headless Mode)
  ui-tests:
    name: Run Selenium UI Tests (Headless)
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install Python Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install selenium

    - name: Install Chrome for Headless Browser
      run: |
        sudo apt-get update
        sudo apt-get install -y wget unzip
        wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
        sudo dpkg -i google-chrome-stable_current_amd64.deb || sudo apt-get -fy install
        google-chrome --version

    - name: Run Selenium UI Tests (Headless)
      run: |
        export DISPLAY=:99
        python ui_tests.py
      env:
        PYTHONUNBUFFERED: 1
